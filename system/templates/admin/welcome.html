{% extends base.html %}

{% block core %}

        <div class="core_title">
        <h1>Contest Overview</h1>
        </div>
        <h2>Announcements</h2>
        <div id="announcements">
        {% if contest.announcements != [] %}

            <a href="/addAnnouncement/">[TODO] New announcement</a>
            {% for msg_i, msg in enumerate(reversed(contest.announcements)) %}
            <div class="announcement_item displayed">
                <span class="announcement_date">{{ datetime.datetime.fromtimestamp(msg["date"]).strftime("%d/%m/%Y %H:%M:%S")  }}</span>
                <span class="announcement_text">{{msg["subject"]}}</span>
            </div>
            {% end %}

        {% else %}
        No announcements.
        {% end %}
        </div>
        <h2>General information</h2>

        {% if phase == 0 %}
            The contest started at {{ time.strftime("%a, %d %b %Y %H:%M:%S (%Z)", time.localtime(contest.start)) }};<br/>it will end at {{ time.strftime("%a, %d %b %Y %H:%M:%S (%Z)", time.localtime(contest.stop)) }}.</p>
        {% elif phase == -1 %}
            The contest starts at {{ time.strftime("%a, %d %b %Y %H:%M:%S (%Z)", time.localtime(contest.start)) }} and will end at {{ time.strftime("%a, %d %b %Y %H:%M:%S (%Z)", time.localtime(contest.stop)) }}.
        {% elif phase == 1 %}
            The contest has ended.
        {% end %}

        <h2>Workers status</h2>

        <table class="sub_table">
          <tr>
            <th>Id</th>
            <th>Address</th>
            <th>Errors</th>
            <th>Current job</th>
          </tr>
          {% for i, w in workers_status.iteritems() %}
          <tr>
            <td>{{ i }}</td>
            <td>{{ w['address'][0] }}:{{ w['address'][1] }}</td>
            <td>{{ w['error_count'] }}</td>
            {% if isinstance(w['job'], str) %}
            <td>{{ w['job'] }}</td>
            {% else %}
            <td>{{ w['job'][0] }} submission {{ w['job'][1] }} since {{ time.ctime(w['start_time']) }}</td>
            {% end %}
          <tr>
          {% end %}
        </table>
{% end %}
