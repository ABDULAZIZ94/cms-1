{% extends base.html %}
{% block core %}
    <div class="core_title">
    <h1>{{ task.title }} ({{ task.name }})</h1>
    </div>

    {% if handler.get_argument("repeated","") == "true" %}
    <span class="error">Your last submission is the same.</span>
    {% end %}

    <h2 onclick="util.toggleVisibility(&quot;task_information&quot;);">
    <span class="toggle" id="task_information_toggle" >-</span>Task Information</h2>
    <div id="task_information">
        <div><a href="/tasks/{{ task.name }}/statement">Download task statement</a></div>

        Time limit: {{ task.time_limit }} second(s)</br>
        Memory limit: {{ task.memory_limit }} MB
    </div>


    <h2 onclick="util.toggleVisibility(&quot;submit_solution&quot;);">
    <span class="toggle" id="submit_solution_toggle" >-</span>Submit a solution</h2>
    <div id="submit_solution">
        <form enctype="multipart/form-data" action="/submit/{{ task.name }}" method="post">
            <input type="file" name="{{ task.name }}"></input>
            <input type="submit" value="Submit"></input>
        </form>
    </div>

    <h2 onclick="util.toggleVisibility(&quot;previous_submissions&quot;);">
    <span class="toggle" id="previous_submissions_toggle" >-</span>Previous submissions</h2>
    <div id="previous_submissions">
        <div class="task_tokens">
        {% if BusinessLayer.token_available(contest, current_user, task, time.time() ) %}
            <i>You can use up to <b>{{ BusinessLayer.available_tokens(contest, current_user, task, time.time()) }}</b> tokens for this task.</i>
        {% else %}
            <i>You can't use tokens for this task at this time.</i>
        {% end %}
        </div>

        {% if submissions == [] %}
        No submissions found.
        {% else %}
            <table class="sub_table">
            <tr>
                <th>Date</th>
                <th>Compilation<br/>status</th>
                <th>Evaluation<br/>status</th>
                <th>Files</th>
                <th>Detailed<br/>Feedback<br/>Requested</th>
            </tr>
            {% for s in sorted(submissions, key=lambda s: s.timestamp , reverse = True) %}
                <tr>
                    <td><a href="/submissions/details/{{ s.id }}">{{ datetime.datetime.fromtimestamp(s.timestamp).strftime("%d/%m/%Y %H:%M:%S") }}</a></td>
                    <td>{{ s.compilation_outcome }}</td>
                    <td>
                    Not yet implemented!
                    <!--
                        {% comment if s.evaluation_outcome != None %}
                            Evaluated
                        {% comment elif s.compilation_outcome == "fail" %}
                            Ignored
                        {% comment else %}
                            Queued, please wait
                        {% comment end %}
                    -->
                    </td>
                    <td>
                    {% for key,value in s.files.items() %}
                        <a href="/submission_file/{{ s.id }}/{{ escape(key) }}">{{ escape(key) }}<br/>
                    {% end %}
                    <td>
                    {% if s.token_timestamp==None %}
                        <form class="submit_form" action="/usetoken/" method="POST">
                        No
                        <input type="hidden" name="id" value="{{ s.id }}"/>
                        <input type="submit" value="Use Token"/>
                        </form>
                    {% else %}
                        Yes
                    {% end %}
                </tr>
            {% end %}
            </table>
        {% end %}
    </div>
{% end %}
