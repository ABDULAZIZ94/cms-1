{% extends base.html %}
{% block core %}

{% from cms.server import format_token_rules %}
{% from cms.grading.tasktypes import get_task_type %}

<div class="span9">

<div class="page-header">
    <h1>{{ _("Overview") }}</h1>
</div>

<h2>{{ _("General information") }}</h2>
<div class="row">
{% if contest.per_user_time is not None %}
    <div class="span5">
{% else %}
    <div class="span9">
{% end %}
        <p>
    {% if phase == -1 %}
        {{ _("The contest will start at %(start_time)s and will end at %(stop_time)s.") % {"start_time": format_time_or_date(contest.start), "stop_time": format_time_or_date(contest.stop)} }}
    {% elif phase == 0 %}
        {{ _("The contest started at %(start_time)s and will end at %(stop_time)s.") % {"start_time": format_time_or_date(contest.start), "stop_time": format_time_or_date(contest.stop)} }}
    {% elif phase == -1 %}
        {{ _("The contest started at %(start_time)s and ended at %(stop_time)s.") % {"start_time": format_time_or_date(contest.start), "stop_time": format_time_or_date(contest.stop)} }}
    {% end %}
        </p>

    {% if contest.per_user_time is not None %}
        <p>
        {{ _("Every user is allowed to compete (i.e. submit solutions) for a (contiguous/consecutive/continuous/uninterrupted) time frame of %(per_user_time)s.") % {"per_user_time": format_amount_of_time(contest.per_user_time)} }}
        </p>
    {% end %}

        {% comment TODO something about tokens... %}

    </div>
{% if contest.per_user_time is not None %}
    <div class="span4">
        {{ _("As soon as the contest starts you can choose to start your time frame. Once you start, you can submit solutions until the end of the time frame or until the end of the contest, whatever comes first.") }}
    </div>
{% end %}
</div>



{% if phase >= 0 %}
<h2>Task overview</h2>

<table class="table table-bordered table-striped">
    <!-- <colgroup>
        <col class="task"/>
        <col class="time_limit"/>
        <col class="memory_limit"/>
        <col class="n_inputs"/>
        <col class="task_type"/>
        <col class="files"/>
    </colgroup> -->
    <thead>
        <tr>
            <th>{{ _("Task") }}</th>
            <th>{{ _("Name") }}</th>
            <th>{{ _("Time limit") }}</th>
            <th>{{ _("Memory limit") }}</th>
            <th>{{ _("Testcases") }}</th>
            <th>{{ _("Type") }}</th>
            <th>{{ _("Files") }}</th>
{% if contest.token_initial is not None %}
            <th>{{ _("Tokens") }}</th>
{% end %}
        </tr>
    </thead>
    <tbody>
{% for t_iter in contest.tasks %}
        <tr>
            <th>{{ t_iter.name }}</th>
            <td>{{ t_iter.title }}</td>
            <td>
    {% if t_iter.time_limit == 1.0 %}
        {{ _("%(seconds)g second") % {"seconds": t_iter.time_limit} }}
    {% else %}
        {{ _("%(seconds)g seconds") % {"seconds": t_iter.time_limit} }}
    {% end %}
            <td>{{ _("%(mb)d MiB") % {"mb": t_iter.memory_limit} }}</td>
            <td>{{ len(t_iter.testcases) }} (public: {{ sum(map(lambda a: 1 if a.public else 0, t_iter.testcases)) }})</td>
            <td>{{ get_task_type(task=t_iter).name }}</td>
            <td>{{ " ".join(a.filename.replace("%l", "[c|cpp|pas]") for a in t_iter.submission_format) }}</td>
    {% if contest.token_initial is not None %}
            <td>
        {% if t_iter.token_initial is not None %}
            Yes
        {% else %}
            No
        {% end %}
            </td>
    {% end %}
        </tr>
{% end %}
    </tbody>
</table>

{% end %}

</div>
{% end %}
